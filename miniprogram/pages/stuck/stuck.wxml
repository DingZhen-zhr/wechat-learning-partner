<view class="container">
  <!-- 1. 聊天内容区域 -->
  <scroll-view class="chat-list" scroll-y="true" scroll-into-view="{{toView}}" scroll-with-animation="true">
    <block wx:for="{{msgList}}" wx:key="index">
      
      <!-- AI的消息 (左侧) -->
      <view class="chat-item left" wx:if="{{item.type === 'ai'}}">
        <image class="avatar" src="/images/icons/doubao.png" mode="aspectFill"></image> <!-- 请确保images下有图片，或者删掉image标签 -->
        <view class="bubble ai-bubble">
          <text user-select="true">{{item.content}}</text>
        </view>
      </view>

      <!-- 用户的消息 (右侧) -->
      <view class="chat-item right" wx:if="{{item.type === 'user'}}">
        <view class="bubble user-bubble">
          <text user-select="true">{{item.content}}</text>
        </view>
        <image class="avatar" src="/images/icons/user_avatar.png" mode="aspectFill"></image> <!-- 请确保images下有图片 -->
      </view>

    </block>
    
    <!-- 加载中提示 -->
    <view class="loading-wrap" wx:if="{{isAiThinking}}">
      <view class="loading-dots">AI 正在思考...</view>
    </view>

    <!-- 用于自动滚动到底部的锚点 -->
    <view id="scroll-bottom"></view>
  </scroll-view>

  <!-- 2. 底部输入区域 -->
  <view class="input-area">
    <!-- 切换语音/键盘图标 -->
    <image class="icon-btn" src="{{isVoiceMode ? '/images/icons/mic.png' : '/images/icons/keyboard.png'}}" bindtap="toggleInputMode"></image>

    <!-- 文本输入框 -->
    <input 
      wx:if="{{!isVoiceMode}}" 
      class="text-input" 
      value="{{inputText}}" 
      bindinput="onInput" 
      bindconfirm="sendText" 
      confirm-type="send" 
      placeholder="输入你的问题..."
    />

    <!-- 语音按住按钮 -->
    <view 
      wx:else 
      class="voice-btn {{isRecording ? 'recording' : ''}}"
      bindtouchstart="startRecord" 
      bindtouchend="stopRecord"
    >
      {{isRecording ? '松开 结束' : '按住 说话'}}
    </view>

    <!-- 发送按钮 (仅文本模式且有内容时显示) -->
    <view class="send-btn" wx:if="{{!isVoiceMode && inputText.length > 0}}" bindtap="sendText">发送</view>
  </view>
</view>